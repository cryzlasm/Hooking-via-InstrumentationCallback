<div class="message break-all" isfirst="1">
						
				
				    <p>&nbsp; &nbsp; &nbsp; &nbsp; 本文中，我想介绍一种非常有趣的尾部挂钩方法，该方法在2015年的REcon会议上由Alex提出。</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; 尾部绕过技术允许后处理，这对于在原始流程执行完毕之后对输出参数进行过滤十分有用。</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; 这并不是一种新的技术，但我认为，这种技术及其我试验过的所有会引发崩溃的POC代码都十分有趣。</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; 我尝试构建不会引发崩溃（至少对我而言）并且能够正常结束的POC（顺便提一句，它生成一个EXE文件，而不是DLL）。</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; 在KPROCESS结构的偏移地址0x2c8处，包含一个名为InstrumentationCallback的域（在Windbg调试器中利用相应的命令能够看到该域，具体如下所示）：</p><p></p><div><table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python value">0</code><code class="python plain">:</code><code class="python value">000</code><code class="python plain">&gt;&nbsp;dt&nbsp;_KPROCESS</code></div><div class="line number2 index1 alt1"><code class="python plain">ntdll!_KPROCESS</code></div><div class="line number3 index2 alt2"><code class="python keyword">+</code><code class="python value">0x000</code>&nbsp;<code class="python plain">Header&nbsp;:&nbsp;_DISPATCHER_HEADER</code></div><div class="line number4 index3 alt1"><code class="python keyword">+</code><code class="python value">0x018</code>&nbsp;<code class="python plain">ProfileListHead&nbsp;:&nbsp;_LIST_ENTRY</code></div><div class="line number5 index4 alt2"><code class="python keyword">+</code><code class="python value">0x028</code>&nbsp;<code class="python plain">DirectoryTableBase&nbsp;:&nbsp;Uint8B</code></div><div class="line number6 index5 alt1"><code class="python keyword">+</code><code class="python value">0x030</code>&nbsp;<code class="python plain">ThreadListHead&nbsp;:&nbsp;_LIST_ENTRY</code></div><div class="line number7 index6 alt2"><code class="python keyword">+</code><code class="python value">0x040</code>&nbsp;<code class="python plain">ProcessLock&nbsp;:&nbsp;Uint4B</code></div><div class="line number8 index7 alt1"><code class="python keyword">+</code><code class="python value">0x044</code>&nbsp;<code class="python plain">ProcessTimerDelay&nbsp;:&nbsp;Uint4B</code></div><div class="line number9 index8 alt2"><code class="python keyword">+</code><code class="python value">0x048</code>&nbsp;<code class="python plain">DeepFreezeStartTime&nbsp;:&nbsp;Uint8B</code></div><div class="line number10 index9 alt1"><code class="python keyword">+</code><code class="python value">0x050</code>&nbsp;<code class="python plain">Affinity&nbsp;:&nbsp;_KAFFINITY_EX</code></div><div class="line number11 index10 alt2"><code class="python keyword">+</code><code class="python value">0x0f8</code>&nbsp;<code class="python plain">ReadyListHead&nbsp;:&nbsp;_LIST_ENTRY</code></div><div class="line number12 index11 alt1"><code class="python keyword">+</code><code class="python value">0x108</code>&nbsp;<code class="python plain">SwapListEntry&nbsp;:&nbsp;_SINGLE_LIST_ENTRY</code></div><div class="line number13 index12 alt2"><code class="python keyword">+</code><code class="python value">0x110</code>&nbsp;<code class="python plain">ActiveProcessors&nbsp;:&nbsp;_KAFFINITY_EX</code></div><div class="line number14 index13 alt1"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">AutoAlignment&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">0</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number15 index14 alt2"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">DisableBoost&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">1</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number16 index15 alt1"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">DisableQuantum&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">2</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number17 index16 alt2"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">DeepFreeze&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">3</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number18 index17 alt1"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">TimerVirtualization&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">4</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number19 index18 alt2"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">CheckStackExtents&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">5</code><code class="python plain">,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number20 index19 alt1"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">PpmPolicy&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">6</code><code class="python plain">,&nbsp;</code><code class="python value">3</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number21 index20 alt2"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">ActiveGroupsMask&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">9</code><code class="python plain">,&nbsp;</code><code class="python value">20</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number22 index21 alt1"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">ReservedFlags&nbsp;:&nbsp;Pos&nbsp;</code><code class="python value">29</code><code class="python plain">,&nbsp;</code><code class="python value">3</code>&nbsp;<code class="python plain">Bit</code></div><div class="line number23 index22 alt2"><code class="python keyword">+</code><code class="python value">0x1b8</code>&nbsp;<code class="python plain">ProcessFlags&nbsp;:&nbsp;Int4B</code></div><div class="line number24 index23 alt1"><code class="python keyword">+</code><code class="python value">0x1bc</code>&nbsp;<code class="python plain">BasePriority&nbsp;:&nbsp;Char</code></div><div class="line number25 index24 alt2"><code class="python keyword">+</code><code class="python value">0x1bd</code>&nbsp;<code class="python plain">QuantumReset&nbsp;:&nbsp;Char</code></div><div class="line number26 index25 alt1"><code class="python keyword">+</code><code class="python value">0x1be</code>&nbsp;<code class="python plain">Visited&nbsp;:&nbsp;UChar</code></div><div class="line number27 index26 alt2"><code class="python keyword">+</code><code class="python value">0x1bf</code>&nbsp;<code class="python plain">Flags&nbsp;:&nbsp;_KEXECUTE_OPTIONS</code></div><div class="line number28 index27 alt1"><code class="python keyword">+</code><code class="python value">0x1c0</code>&nbsp;<code class="python plain">ThreadSeed&nbsp;:&nbsp;[</code><code class="python value">20</code><code class="python plain">]&nbsp;Uint4B</code></div><div class="line number29 index28 alt2"><code class="python keyword">+</code><code class="python value">0x210</code>&nbsp;<code class="python plain">IdealNode&nbsp;:&nbsp;[</code><code class="python value">20</code><code class="python plain">]&nbsp;Uint2B</code></div><div class="line number30 index29 alt1"><code class="python keyword">+</code><code class="python value">0x238</code>&nbsp;<code class="python plain">IdealGlobalNode&nbsp;:&nbsp;Uint2B</code></div><div class="line number31 index30 alt2"><code class="python keyword">+</code><code class="python value">0x23a</code>&nbsp;<code class="python plain">Spare1&nbsp;:&nbsp;Uint2B</code></div><div class="line number32 index31 alt1"><code class="python keyword">+</code><code class="python value">0x23c</code>&nbsp;<code class="python plain">StackCount&nbsp;:&nbsp;_KSTACK_COUNT</code></div><div class="line number33 index32 alt2"><code class="python keyword">+</code><code class="python value">0x240</code>&nbsp;<code class="python plain">ProcessListEntry&nbsp;:&nbsp;_LIST_ENTRY</code></div><div class="line number34 index33 alt1"><code class="python keyword">+</code><code class="python value">0x250</code>&nbsp;<code class="python plain">CycleTime&nbsp;:&nbsp;Uint8B</code></div><div class="line number35 index34 alt2"><code class="python keyword">+</code><code class="python value">0x258</code>&nbsp;<code class="python plain">ContextSwtiches&nbsp;:&nbsp;Uint8B</code></div><div class="line number36 index35 alt1"><code class="python keyword">+</code><code class="python value">0x260</code>&nbsp;<code class="python plain">SchedulingGroup&nbsp;:&nbsp;Ptr64&nbsp;_KSCHEDULING_GROUP</code></div><div class="line number37 index36 alt2"><code class="python keyword">+</code><code class="python value">0x268</code>&nbsp;<code class="python plain">FreezeCount&nbsp;:&nbsp;Uint4B</code></div><div class="line number38 index37 alt1"><code class="python keyword">+</code><code class="python value">0x26c</code>&nbsp;<code class="python plain">KernelTime&nbsp;:&nbsp;Uint4B</code></div><div class="line number39 index38 alt2"><code class="python keyword">+</code><code class="python value">0x270</code>&nbsp;<code class="python plain">UserTime&nbsp;:&nbsp;Uint4B</code></div><div class="line number40 index39 alt1"><code class="python keyword">+</code><code class="python value">0x274</code>&nbsp;<code class="python plain">ReadyTime&nbsp;:&nbsp;Uint4B</code></div><div class="line number41 index40 alt2"><code class="python keyword">+</code><code class="python value">0x278</code>&nbsp;<code class="python plain">Spare2&nbsp;:&nbsp;[</code><code class="python value">80</code><code class="python plain">]&nbsp;UChar</code></div><div class="line number42 index41 alt1"><code class="python keyword">+</code><code class="python value">0x2c8</code>&nbsp;<code class="python plain">InstrumentationCallback&nbsp;:&nbsp;Ptr64&nbsp;Void&nbsp;&lt;&lt;&lt;&nbsp;That’s&nbsp;it&nbsp;:)</code></div><div class="line number43 index42 alt2"><code class="python keyword">+</code><code class="python value">0x2d0</code>&nbsp;<code class="python plain">SecureState&nbsp;:&nbsp;&lt;unnamed</code><code class="python keyword">-</code><code class="python plain">tag&gt;</code></div></div></td></tr></tbody></table></div><div><span style="font-size:12;">&nbsp; &nbsp; &nbsp; &nbsp; 在Windows系统Vista以及之后的版本中，你可以使用InstrumentationCallback域来指定回调函数的地址，每次函数从内核态返回用户态之后系统都会调用指定的回调函数。</span><br></div> <p>&nbsp; &nbsp; &nbsp; &nbsp; 一种指定回调函数的方法是使用驱动实现，但实践证明还有一种更简单的方式，即使用无需任何特殊权限的用户态API函数NtSetInformationProcess，我们只需要配置正确的结构体就够了。具体代码如下所示：</p>   <div><table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION&nbsp;nirvana;</code></div><div class="line number2 index1 alt1"><code class="python plain">nirvana.Callback&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">(PVOID)(ULONG_PTR)medium;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">callback&nbsp;function</code></div><div class="line number3 index2 alt2"><code class="python plain">nirvana.Reserved&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python value">0</code><code class="python plain">;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">always&nbsp;</code><code class="python value">0</code></div><div class="line number4 index3 alt1"><code class="python plain">nirvana.Version&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python value">0</code><code class="python plain">;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python value">0</code>&nbsp;<code class="python keyword">for</code>&nbsp;<code class="python plain">x64,&nbsp;</code><code class="python value">1</code>&nbsp;<code class="python keyword">for</code>&nbsp;<code class="python plain">x86</code></div><div class="line number5 index4 alt2"><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">just&nbsp;one&nbsp;call</code></div><div class="line number6 index5 alt1"><code class="python plain">NtSetInformationProcess(GetCurrentProcess(),&nbsp;</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">(PROCESS_INFORMATION_CLASS)ProcessInstrumentationCallback,</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">&amp;nirvana,&nbsp;</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sizeof(nirvana)&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">*</code><code class="python value">0x08</code><code class="python keyword">*</code><code class="python keyword">/</code><code class="python plain">);</code></div></div></td></tr></tbody></table></div><div><span style="font-size:12;">&nbsp; &nbsp; &nbsp; &nbsp; 然而有个困难是，由于需要直接与寄存器打交道，我们必须使用汇编语言编写回调函数的代码。具体如下所示：</span><br></div>   <div><table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">include&nbsp;ksamd64.inc</code></div><div class="line number2 index1 alt1"><code class="python plain">EXTERN&nbsp;hook:NEAR</code></div><div class="line number3 index2 alt2"><code class="python plain">.code</code></div><div class="line number4 index3 alt1"><code class="python plain">medium&nbsp;PROC</code></div><div class="line number5 index4 alt2"><code class="python plain">;&nbsp;为什么要压入这些寄存器的值？请参考网址：</code></div><div class="line number6 index5 alt1"><code class="python plain">;&nbsp;https:</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">docs.microsoft.com</code><code class="python keyword">/</code><code class="python plain">en</code><code class="python keyword">-</code><code class="python plain">us</code><code class="python keyword">/</code><code class="python plain">cpp</code><code class="python keyword">/</code><code class="python plain">build</code><code class="python keyword">/</code><code class="python plain">caller</code><code class="python keyword">-</code><code class="python plain">callee</code><code class="python keyword">-</code><code class="python plain">saved</code><code class="python keyword">-</code><code class="python plain">registers</code></div><div class="line number7 index6 alt2"><code class="python plain">push&nbsp;rax&nbsp;&nbsp;;&nbsp;返回值</code></div><div class="line number8 index7 alt1"><code class="python plain">push&nbsp;rcx</code></div><div class="line number9 index8 alt2"><code class="python plain">push&nbsp;rbx</code></div><div class="line number10 index9 alt1"><code class="python plain">push&nbsp;rbp</code></div><div class="line number11 index10 alt2"><code class="python plain">push&nbsp;rdi</code></div><div class="line number12 index11 alt1"><code class="python plain">push&nbsp;rsi</code></div><div class="line number13 index12 alt2"><code class="python plain">push&nbsp;rsp</code></div><div class="line number14 index13 alt1"><code class="python plain">push&nbsp;r12</code></div><div class="line number15 index14 alt2"><code class="python plain">push&nbsp;r13</code></div><div class="line number16 index15 alt1"><code class="python plain">push&nbsp;r14</code></div><div class="line number17 index16 alt2"><code class="python plain">push&nbsp;r15</code></div><div class="line number18 index17 alt1"><code class="python plain">;&nbsp;没有以下这条语句，程序将引发崩溃</code></div><div class="line number19 index18 alt2"><code class="python plain">;&nbsp;其实一个小得多的值就足够了，详见网址：</code></div><div class="line number20 index19 alt1"><code class="python plain">;&nbsp;https:</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">www.reddit.com</code><code class="python keyword">/</code><code class="python plain">r</code><code class="python keyword">/</code><code class="python plain">ReversEngineering</code><code class="python keyword">/</code><code class="python plain">comments</code><code class="python keyword">/</code><code class="python value">7gpkw4</code><code class="python keyword">/</code><code class="python plain">hooking_via_instrumentationcallback</code><code class="python keyword">/</code></div><div class="line number21 index20 alt2"><code class="python plain">;&nbsp;P.S.&nbsp;感谢反馈</code></div><div class="line number22 index21 alt1"><code class="python plain">sub&nbsp;rsp,&nbsp;</code><code class="python value">1000h</code></div><div class="line number23 index22 alt2"><code class="python plain">mov&nbsp;rdx,&nbsp;rax</code></div><div class="line number24 index23 alt1"><code class="python plain">mov&nbsp;rcx,&nbsp;r10</code></div><div class="line number25 index24 alt2"><code class="python plain">call&nbsp;hook</code></div><div class="line number26 index25 alt1"><code class="python plain">add&nbsp;rsp,&nbsp;</code><code class="python value">1000h</code></div><div class="line number27 index26 alt2"><code class="python plain">pop&nbsp;r15</code></div><div class="line number28 index27 alt1"><code class="python plain">pop&nbsp;r14</code></div><div class="line number29 index28 alt2"><code class="python plain">pop&nbsp;r13</code></div><div class="line number30 index29 alt1"><code class="python plain">pop&nbsp;r12</code></div><div class="line number31 index30 alt2"><code class="python plain">pop&nbsp;rsp</code></div><div class="line number32 index31 alt1"><code class="python plain">pop&nbsp;rsi</code></div><div class="line number33 index32 alt2"><code class="python plain">pop&nbsp;rdi</code></div><div class="line number34 index33 alt1"><code class="python plain">pop&nbsp;rbp</code></div><div class="line number35 index34 alt2"><code class="python plain">pop&nbsp;rbx</code></div><div class="line number36 index35 alt1"><code class="python plain">pop&nbsp;rcx</code></div><div class="line number37 index36 alt2"><code class="python plain">pop&nbsp;rax</code></div><div class="line number38 index37 alt1"><code class="python plain">jmp&nbsp;r10</code></div><div class="line number39 index38 alt2"><code class="python plain">medium&nbsp;ENDP</code></div><div class="line number40 index39 alt1"><code class="python plain">END</code></div></div></td></tr></tbody></table></div><div><br></div>    <p>&nbsp; &nbsp; &nbsp; &nbsp; 以上:) &nbsp;代码成功运行于Windows 10 v1709 x64系统</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; 你可以从如下网址获取POC代码：</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; https://github.com/secrary/Hooking-via-InstrumentationCallback</p>  <p><br></p><p>&nbsp; &nbsp; &nbsp; &nbsp; 资源：</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; ·对Nirvana进行挂钩（https://www.youtube.com/watch?v=bqU0y4FzvT0）</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; ·Windows x64系统的系统服务挂钩技术和高级调试（https://www.codeproject.com/Articles/543542/Windows-x-system-service-hooks-and-advanced-debug）</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; ·反调试技巧（https://pastebin.com/9TqRGsM5）</p> <p>&nbsp; &nbsp; &nbsp; &nbsp; ·Windows 10系统对Nirvana进行挂钩操作简介（https://sww-it.ru/2016-04-11/1332）</p>    <br><p></p>   <div><br></div><div><br></div><div>原文地址：https://secrary.com/Random/InstrumentationCallback/</div><div>本文由 &nbsp;看雪翻译小组 木无聊偶 &nbsp;编译</div><div>转载请注明来源</div>				
				
								
				
						</div>
